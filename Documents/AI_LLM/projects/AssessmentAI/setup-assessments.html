<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Assessments</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Setup LoRA and RAG Assessments</h1>
    <div id="output"></div>
    <button onclick="setupAssessments()" style="padding: 10px 20px; font-size: 16px; margin: 10px; background: #4CAF50; color: white; border: none; border-radius: 4px;">
        ðŸš€ Create LoRA & RAG Assessments
    </button>
    
    <script>
        const supabaseUrl = 'https://chktzonseacamniddifq.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoa3R6b25zZWFjYW1uaWRkaWZxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4MTM0OTgsImV4cCI6MjA4MTM4OTQ5OH0.ls993dsdw6Trf_pHVxNyuYceXki7o4hD_TkLF3FQGv4'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        async function setupAssessments() {
            const output = document.getElementById('output')
            output.innerHTML = '<h3>Setting up assessments...</h3>'
            
            try {
                // Check authentication
                const { data: { user }, error: authError } = await supabase.auth.getUser()
                if (authError || !user) {
                    output.innerHTML += '<p style="color: red;">Please log in first!</p>'
                    return
                }
                
                output.innerHTML += `<p><strong>User:</strong> ${user.email}</p>`
                
                // Create LoRA assessment
                const loraId = crypto.randomUUID()
                const { data: loraAssessment, error: loraError } = await supabase
                    .from('custom_assessment_types')
                    .insert({
                        id: loraId,
                        user_id: user.id,
                        name: 'LoRA',
                        description: 'LoRA (Low-Rank Adaptation) assessment',
                        icon: 'Brain',
                        color: '#4CAF50',
                        is_public: false
                    })
                    .select()
                    .single()
                
                if (loraError) {
                    output.innerHTML += `<p style="color: red;">Error creating LoRA: ${loraError.message}</p>`
                } else {
                    output.innerHTML += `<p style="color: green;">âœ… Created LoRA assessment (ID: ${loraId})</p>`
                }
                
                // Create RAG assessment
                const ragId = crypto.randomUUID()
                const { data: ragAssessment, error: ragError } = await supabase
                    .from('custom_assessment_types')
                    .insert({
                        id: ragId,
                        user_id: user.id,
                        name: 'RAG',
                        description: 'RAG (Retrieval-Augmented Generation) assessment',
                        icon: 'Database',
                        color: '#2196F3',
                        is_public: false
                    })
                    .select()
                    .single()
                
                if (ragError) {
                    output.innerHTML += `<p style="color: red;">Error creating RAG: ${ragError.message}</p>`
                } else {
                    output.innerHTML += `<p style="color: green;">âœ… Created RAG assessment (ID: ${ragId})</p>`
                }
                
                // Verify creation
                const { data: allAssessments } = await supabase
                    .from('custom_assessment_types')
                    .select('*')
                    .eq('user_id', user.id)
                
                output.innerHTML += '<h3>Current Assessments in Database:</h3>'
                if (allAssessments && allAssessments.length > 0) {
                    allAssessments.forEach(assessment => {
                        output.innerHTML += `<p>- ${assessment.name} (ID: ${assessment.id})</p>`
                        output.innerHTML += `<p style="margin-left: 20px; font-size: 12px; color: #666;">
                            URL: /assessment/${assessment.id}
                        </p>`
                    })
                } else {
                    output.innerHTML += '<p>No assessments found</p>'
                }
                
                output.innerHTML += '<h3>Next Steps:</h3>'
                output.innerHTML += '<p>1. Go to Question Manager</p>'
                output.innerHTML += '<p>2. Select LoRA or RAG assessment</p>'
                output.innerHTML += '<p>3. Upload your Excel file with questions</p>'
                output.innerHTML += '<p>4. Try accessing the assessment</p>'
                
            } catch (error) {
                output.innerHTML += `<p style="color: red;">Setup failed: ${error.message}</p>`
                console.error('Setup error:', error)
            }
        }
    </script>
</body>
</html>